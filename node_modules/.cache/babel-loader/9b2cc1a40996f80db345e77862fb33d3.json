{"ast":null,"code":"var _jsxFileName = \"/Users/lttttoai/Documents/GitHub/carovn/src/containers/GameOnline/AppOnline.js\";\nimport React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport { Link, withRouter } from 'react-router-dom';\nimport PubNubReact from 'pubnub-react';\nimport Swal from 'sweetalert2';\nimport shortid from 'shortid';\nimport GameOnline from './GameOnline';\nimport Board from '../../components/Board'; // import './Game.css';\n\nclass AppOnline extends Component {\n  constructor(props) {\n    super(props);\n\n    this.onPressCreate = () => {\n      // Create a random name for the channel\n      this.roomId = shortid.generate().substring(0, 5);\n      this.lobbyChannel = \"tictactoelobby--\".concat(this.roomId);\n      this.pubnub.subscribe({\n        channels: [this.lobbyChannel],\n        withPresence: true\n      }); // Open the modal\n\n      Swal.fire({\n        position: 'top',\n        allowOutsideClick: false,\n        title: 'Your room ID:',\n        text: this.roomId,\n        width: 275,\n        padding: '0.7em',\n        // Custom CSS\n        customClass: {\n          heightAuto: false,\n          title: 'title-class',\n          popup: 'popup-class',\n          confirmButton: 'button-class'\n        }\n      });\n      this.setState({\n        piece: 'X',\n        isRoomCreator: true,\n        isDisabled: true,\n        // Disable the 'Create' button\n        myTurn: true // Room creator makes the 1st move\n\n      });\n    };\n\n    this.onPressJoin = () => {\n      Swal.fire({\n        position: 'top',\n        input: 'text',\n        allowOutsideClick: false,\n        inputPlaceholder: 'Enter the room id',\n        showCancelButton: true,\n        confirmButtonColor: 'rgb(208,33,41)',\n        confirmButtonText: 'OK',\n        width: 275,\n        padding: '0.7em',\n        customClass: {\n          heightAuto: false,\n          popup: 'popup-class',\n          confirmButton: 'join-button-class ',\n          cancelButton: 'join-button-class'\n        }\n      }).then(result => {\n        // Check if the user typed a value in the input field\n        if (result.value) {\n          this.joinRoom(result.value);\n        }\n      });\n    };\n\n    this.joinRoom = value => {\n      this.roomId = value;\n      this.lobbyChannel = \"tictactoelobby--\".concat(this.roomId); // Check the number of people in the channel\n\n      this.pubnub.hereNow({\n        channels: [this.lobbyChannel]\n      }).then(response => {\n        if (response.totalOccupancy < 2) {\n          this.pubnub.subscribe({\n            channels: [this.lobbyChannel],\n            withPresence: true\n          });\n          this.setState({\n            piece: 'O'\n          });\n          this.pubnub.publish({\n            message: {\n              notRoomCreator: true\n            },\n            channel: this.lobbyChannel\n          });\n        } else {\n          // Game in progress\n          Swal.fire({\n            position: 'top',\n            allowOutsideClick: false,\n            title: 'Error',\n            text: 'Game in progress. Try another room.',\n            width: 275,\n            padding: '0.7em',\n            customClass: {\n              heightAuto: false,\n              title: 'title-class',\n              popup: 'popup-class',\n              confirmButton: 'button-class'\n            }\n          });\n        }\n      }).catch(error => {\n        throw error;\n      });\n    };\n\n    this.onSearchRoom = () => {\n      // Create a random name for the channel\n      this.roomId = '0';\n      this.lobbyChannel = \"tictactoelobby--\".concat(this.roomId);\n      this.pubnub.subscribe({\n        channels: [this.lobbyChannel],\n        withPresence: true\n      }); // Open the modal\n\n      Swal.fire({\n        text: this.roomId,\n        width: 275,\n        padding: '0.7em',\n        // Custom CSS\n        customClass: {\n          heightAuto: false,\n          title: 'title-class',\n          popup: 'popup-class'\n        }\n      });\n      this.setState({\n        piece: 'X',\n        isRoomCreator: true,\n        isDisabled: true,\n        // Disable the 'Create' button\n        myTurn: true // Room creator makes the 1st move\n\n      });\n      Swal.fire({\n        position: 'top',\n        input: this.roomId,\n        allowOutsideClick: false,\n        showCancelButton: true,\n        confirmButtonColor: 'rgb(208,33,41)',\n        confirmButtonText: 'OK',\n        width: 275,\n        padding: '0.7em',\n        customClass: {\n          heightAuto: false,\n          popup: 'popup-class',\n          confirmButton: 'join-button-class ',\n          cancelButton: 'join-button-class'\n        }\n      }).then(result => {\n        // Check if the user typed a value in the input field\n        if (result.value) {\n          this.joinRoom(this.roomId);\n        }\n      });\n    };\n\n    this.endGame = () => {\n      this.setState({\n        piece: '',\n        isPlaying: false,\n        isRoomCreator: false,\n        isDisabled: false,\n        myTurn: false\n      });\n      this.lobbyChannel = null;\n      this.gameChannel = null;\n      this.roomId = null;\n      this.pubnub.unsubscribe({\n        channels: [this.lobbyChannel, this.gameChannel]\n      });\n    };\n\n    this.pubnub = new PubNubReact({\n      publishKey: 'pub-c-34534fcf-4283-47c8-946e-6c47f33fe136',\n      subscribeKey: 'sub-c-8917020c-fc69-11e9-8dd7-ca99873d233c'\n    });\n    this.state = {\n      piece: '',\n      isPlaying: false,\n      isRoomCreator: false,\n      isDisabled: false,\n      myTurn: false\n    };\n    this.lobbyChannel = null;\n    this.gameChannel = null;\n    this.roomId = null;\n    this.pubnub.init(this);\n  }\n\n  componentDidUpdate() {\n    // Check that the player is connected to a channel\n    if (this.lobbyChannel != null) {\n      this.pubnub.getMessage(this.lobbyChannel, msg => {\n        // Start the game once an opponent joins the channel\n        if (msg.message.notRoomCreator) {\n          // Create a different channel for the game\n          this.gameChannel = \"tictactoegame--\".concat(this.roomId);\n          this.pubnub.subscribe({\n            channels: [this.gameChannel]\n          });\n          this.setState({\n            isPlaying: true\n          }); // Close the modals if they are opened\n\n          Swal.close();\n        }\n      });\n    }\n  }\n\n  componentWillUnmount() {\n    this.pubnub.unsubscribe({\n      channels: [this.lobbyChannel, this.gameChannel]\n    });\n  } // Create a room channel\n\n\n  render() {\n    const _this$state = this.state,\n          isPlaying = _this$state.isPlaying,\n          isDisabled = _this$state.isDisabled,\n          piece = _this$state.piece,\n          isRoomCreator = _this$state.isRoomCreator,\n          myTurn = _this$state.myTurn,\n          xUsername = _this$state.xUsername,\n          oUsername = _this$state.oUsername;\n    const user = this.props.user;\n    return React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 262\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"main_menu\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 263\n      },\n      __self: this\n    }, React.createElement(\"p\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 264\n      },\n      __self: this\n    }, \"Welcome \", user.name, \" to Tic Tac Toe Online\")), React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 266\n      },\n      __self: this\n    }, React.createElement(Link, {\n      to: \"/menu\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 267\n      },\n      __self: this\n    }, React.createElement(\"button\", {\n      type: \"button\",\n      className: \"exit\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 268\n      },\n      __self: this\n    }, \"Back\"))), React.createElement(\"div\", {\n      className: \"game-info1\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 274\n      },\n      __self: this\n    }, React.createElement(\"button\", {\n      type: \"button\",\n      className: \"create-button \",\n      onClick: () => this.onPressCreate(),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 275\n      },\n      __self: this\n    }, ' ', \"Create your Room\"), React.createElement(\"button\", {\n      type: \"button\",\n      className: \"join-button\",\n      onClick: () => this.onPressJoin(),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 283\n      },\n      __self: this\n    }, ' ', \"Join Room\"), React.createElement(\"button\", {\n      type: \"button\",\n      className: \"join-button\",\n      onClick: () => this.onSearchRoom(),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 291\n      },\n      __self: this\n    }, ' ', \"Search Room\")), !isPlaying && React.createElement(\"div\", {\n      className: \"game\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 302\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"game-board\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 303\n      },\n      __self: this\n    }, React.createElement(Board, {\n      squares: 0,\n      onClick: () => null,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 304\n      },\n      __self: this\n    }))), isPlaying && React.createElement(GameOnline, {\n      pubnub: this.pubnub,\n      gameChannel: this.gameChannel,\n      piece: piece,\n      isRoomCreator: isRoomCreator,\n      myTurn: myTurn,\n      xUsername: xUsername,\n      oUsername: oUsername,\n      endGame: this.endGame,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 310\n      },\n      __self: this\n    }));\n  }\n\n}\n\nconst mapStateToProps = state => ({\n  user: state.login.user\n});\n\nexport default withRouter(connect(mapStateToProps)(AppOnline)); // export default App;","map":{"version":3,"sources":["/Users/lttttoai/Documents/GitHub/carovn/src/containers/GameOnline/AppOnline.js"],"names":["React","Component","connect","Link","withRouter","PubNubReact","Swal","shortid","GameOnline","Board","AppOnline","constructor","props","onPressCreate","roomId","generate","substring","lobbyChannel","pubnub","subscribe","channels","withPresence","fire","position","allowOutsideClick","title","text","width","padding","customClass","heightAuto","popup","confirmButton","setState","piece","isRoomCreator","isDisabled","myTurn","onPressJoin","input","inputPlaceholder","showCancelButton","confirmButtonColor","confirmButtonText","cancelButton","then","result","value","joinRoom","hereNow","response","totalOccupancy","publish","message","notRoomCreator","channel","catch","error","onSearchRoom","endGame","isPlaying","gameChannel","unsubscribe","publishKey","subscribeKey","state","init","componentDidUpdate","getMessage","msg","close","componentWillUnmount","render","xUsername","oUsername","user","name","mapStateToProps","login"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport { Link, withRouter } from 'react-router-dom';\nimport PubNubReact from 'pubnub-react';\nimport Swal from 'sweetalert2';\nimport shortid from 'shortid';\nimport GameOnline from './GameOnline';\nimport Board from '../../components/Board';\n\n// import './Game.css';\n\nclass AppOnline extends Component {\n  constructor(props) {\n    super(props);\n    this.pubnub = new PubNubReact({\n      publishKey: 'pub-c-34534fcf-4283-47c8-946e-6c47f33fe136',\n      subscribeKey: 'sub-c-8917020c-fc69-11e9-8dd7-ca99873d233c'\n    });\n\n    this.state = {\n      piece: '',\n      isPlaying: false,\n      isRoomCreator: false,\n      isDisabled: false,\n      myTurn: false\n    };\n\n    this.lobbyChannel = null;\n    this.gameChannel = null;\n    this.roomId = null;\n    this.pubnub.init(this);\n  }\n\n  componentDidUpdate() {\n    // Check that the player is connected to a channel\n    if (this.lobbyChannel != null) {\n      this.pubnub.getMessage(this.lobbyChannel, msg => {\n        // Start the game once an opponent joins the channel\n        if (msg.message.notRoomCreator) {\n          // Create a different channel for the game\n          this.gameChannel = `tictactoegame--${this.roomId}`;\n\n          this.pubnub.subscribe({\n            channels: [this.gameChannel]\n          });\n\n          this.setState({\n            isPlaying: true\n          });\n\n          // Close the modals if they are opened\n          Swal.close();\n        }\n      });\n    }\n  }\n\n  componentWillUnmount() {\n    this.pubnub.unsubscribe({\n      channels: [this.lobbyChannel, this.gameChannel]\n    });\n  }\n\n  // Create a room channel\n  onPressCreate = () => {\n    // Create a random name for the channel\n    this.roomId = shortid.generate().substring(0, 5);\n    this.lobbyChannel = `tictactoelobby--${this.roomId}`;\n\n    this.pubnub.subscribe({\n      channels: [this.lobbyChannel],\n      withPresence: true\n    });\n\n    // Open the modal\n    Swal.fire({\n      position: 'top',\n      allowOutsideClick: false,\n      title: 'Your room ID:',\n      text: this.roomId,\n      width: 275,\n      padding: '0.7em',\n      // Custom CSS\n      customClass: {\n        heightAuto: false,\n        title: 'title-class',\n        popup: 'popup-class',\n        confirmButton: 'button-class'\n      }\n    });\n\n    this.setState({\n      piece: 'X',\n      isRoomCreator: true,\n      isDisabled: true, // Disable the 'Create' button\n      myTurn: true // Room creator makes the 1st move\n    });\n  };\n\n  // The 'Join' button was pressed\n  onPressJoin = () => {\n    Swal.fire({\n      position: 'top',\n      input: 'text',\n      allowOutsideClick: false,\n      inputPlaceholder: 'Enter the room id',\n      showCancelButton: true,\n      confirmButtonColor: 'rgb(208,33,41)',\n      confirmButtonText: 'OK',\n      width: 275,\n      padding: '0.7em',\n      customClass: {\n        heightAuto: false,\n        popup: 'popup-class',\n        confirmButton: 'join-button-class ',\n        cancelButton: 'join-button-class'\n      }\n    }).then(result => {\n      // Check if the user typed a value in the input field\n      if (result.value) {\n        this.joinRoom(result.value);\n      }\n    });\n  };\n\n  // Join a room channel\n  joinRoom = value => {\n    this.roomId = value;\n    this.lobbyChannel = `tictactoelobby--${this.roomId}`;\n\n    // Check the number of people in the channel\n    this.pubnub\n      .hereNow({\n        channels: [this.lobbyChannel]\n      })\n      .then(response => {\n        if (response.totalOccupancy < 2) {\n          this.pubnub.subscribe({\n            channels: [this.lobbyChannel],\n            withPresence: true\n          });\n\n          this.setState({\n            piece: 'O'\n          });\n\n          this.pubnub.publish({\n            message: {\n              notRoomCreator: true\n            },\n            channel: this.lobbyChannel\n          });\n        } else {\n          // Game in progress\n          Swal.fire({\n            position: 'top',\n            allowOutsideClick: false,\n            title: 'Error',\n            text: 'Game in progress. Try another room.',\n            width: 275,\n            padding: '0.7em',\n            customClass: {\n              heightAuto: false,\n              title: 'title-class',\n              popup: 'popup-class',\n              confirmButton: 'button-class'\n            }\n          });\n        }\n      })\n      .catch(error => {\n        throw error;\n      });\n  };\n\n  onSearchRoom = () => {\n    // Create a random name for the channel\n    this.roomId = '0';\n    this.lobbyChannel = `tictactoelobby--${this.roomId}`;\n\n    this.pubnub.subscribe({\n      channels: [this.lobbyChannel],\n      withPresence: true\n    });\n\n    // Open the modal\n\n    Swal.fire({\n      text: this.roomId,\n      width: 275,\n      padding: '0.7em',\n      // Custom CSS\n      customClass: {\n        heightAuto: false,\n        title: 'title-class',\n        popup: 'popup-class'\n      }\n    });\n\n    this.setState({\n      piece: 'X',\n      isRoomCreator: true,\n      isDisabled: true, // Disable the 'Create' button\n      myTurn: true // Room creator makes the 1st move\n    });\n\n    Swal.fire({\n      position: 'top',\n      input: this.roomId,\n      allowOutsideClick: false,\n      showCancelButton: true,\n      confirmButtonColor: 'rgb(208,33,41)',\n      confirmButtonText: 'OK',\n      width: 275,\n      padding: '0.7em',\n      customClass: {\n        heightAuto: false,\n        popup: 'popup-class',\n        confirmButton: 'join-button-class ',\n        cancelButton: 'join-button-class'\n      }\n    }).then(result => {\n      // Check if the user typed a value in the input field\n      if (result.value) {\n        this.joinRoom(this.roomId);\n      }\n    });\n  };\n\n  // Reset everything\n  endGame = () => {\n    this.setState({\n      piece: '',\n      isPlaying: false,\n      isRoomCreator: false,\n      isDisabled: false,\n      myTurn: false\n    });\n\n    this.lobbyChannel = null;\n    this.gameChannel = null;\n    this.roomId = null;\n\n    this.pubnub.unsubscribe({\n      channels: [this.lobbyChannel, this.gameChannel]\n    });\n  };\n\n  render() {\n    const {\n      isPlaying,\n      // eslint-disable-next-line no-unused-vars\n      isDisabled,\n      piece,\n      isRoomCreator,\n      myTurn,\n      xUsername,\n      oUsername\n    } = this.state;\n    const { user } = this.props;\n    return (\n      <div>\n        <div className=\"main_menu\">\n          <p>Welcome {user.name} to Tic Tac Toe Online</p>\n        </div>\n        <div>\n          <Link to=\"/menu\">\n            <button type=\"button\" className=\"exit\">\n              Back\n            </button>\n          </Link>\n        </div>\n\n        <div className=\"game-info1\">\n          <button\n            type=\"button\"\n            className=\"create-button \"\n            onClick={() => this.onPressCreate()}\n          >\n            {' '}\n            Create your Room\n          </button>\n          <button\n            type=\"button\"\n            className=\"join-button\"\n            onClick={() => this.onPressJoin()}\n          >\n            {' '}\n            Join Room\n          </button>\n          <button\n            type=\"button\"\n            className=\"join-button\"\n            onClick={() => this.onSearchRoom()}\n          >\n            {' '}\n            Search Room\n          </button>\n        </div>\n\n        {!isPlaying && (\n          <div className=\"game\">\n            <div className=\"game-board\">\n              <Board squares={0} onClick={() => null} />\n            </div>\n          </div>\n        )}\n\n        {isPlaying && (\n          <GameOnline\n            pubnub={this.pubnub}\n            gameChannel={this.gameChannel}\n            piece={piece}\n            isRoomCreator={isRoomCreator}\n            myTurn={myTurn}\n            xUsername={xUsername}\n            oUsername={oUsername}\n            endGame={this.endGame}\n          />\n        )}\n      </div>\n    );\n  }\n}\n\nconst mapStateToProps = state => ({\n  user: state.login.user\n});\n\nexport default withRouter(connect(mapStateToProps)(AppOnline));\n// export default App;\n"]},"metadata":{},"sourceType":"module"}